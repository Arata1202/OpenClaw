services:
  openclaw-gateway:
    build: ./openclaw
    image: ${OPENCLAW_IMAGE:-openclaw:local}
    container_name: openclaw-gateway
    restart: unless-stopped
    env_file: [.env]
    environment:
      - NODE_ENV=production
      - HOME=/home/node
      - GH_CONFIG_DIR=/home/node/.openclaw/gh
    command:
      - node
      - dist/index.js
      - gateway
      - --port
      - "18789"
      - --bind
      - "${OPENCLAW_GATEWAY_BIND:-lan}"
      - --token
      - "${OPENCLAW_GATEWAY_TOKEN}"
    ports:
      - "127.0.0.1:${OPENCLAW_GATEWAY_PORT:-18789}:18789"
    volumes:
      - "${OPENCLAW_CONFIG_DIR}:/home/node/.openclaw"
      - "${OPENCLAW_WORKSPACE_DIR}:/home/node/openclaw"

  openclaw-cli:
    image: ${OPENCLAW_IMAGE:-openclaw:local}
    build: ./openclaw
    profiles: ["cli"]
    env_file: [.env]
    environment:
      - NODE_ENV=production
      - HOME=/home/node
      - GH_CONFIG_DIR=/home/node/.openclaw/gh
    entrypoint: ["node", "dist/index.js"]
    volumes:
      - "${OPENCLAW_CONFIG_DIR}:/home/node/.openclaw"
      - "${OPENCLAW_WORKSPACE_DIR}:/home/node/openclaw"
